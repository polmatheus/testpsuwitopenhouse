<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบลงทะเบียนกิจกรรม ISTEM - PSUWIT</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { --primary-color: #0d47a1; --secondary-color: #1976d2; --bg-color: #f0f4f8; }
        body { font-family: 'Sarabun', sans-serif; background-color: var(--bg-color); min-height: 100vh; padding-bottom: 80px; }
        
        .banner-container {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white; padding: 20px 0; border-radius: 0 0 25px 25px; margin-bottom: 30px;
        }
        .logo-circle { width: 90px; height: 90px; transition: transform 0.3s; }
        .logo-circle:hover { transform: scale(1.1); }

        .main-card { background: white; border-radius: 15px; padding: 30px; max-width: 600px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        .btn-main { background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border-radius: 50px; width: 100%; padding: 12px; font-weight: bold; border:none; }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.2); color:white;}
        
        .table-container { background: white; border-radius: 15px; padding: 15px; overflow-x: auto; }
        .sticky-col { position: sticky; left: 0; background: white; z-index: 5; border-right: 2px solid #dee2e6; min-width: 140px; }
        
        .slot-btn { width: 100%; padding: 4px; font-size: 0.75rem; border-radius: 6px; border: 1px solid #dee2e6; margin-bottom: 4px; min-height: 40px; }
        .btn-green { background-color: #f8fff9; color: #198754; border-color: #198754; }
        .btn-selected { background-color: var(--primary-color) !important; color: white !important; transform: scale(1.05); }
        .btn-full { background-color: #fdeaea; color: #dc3545; border-color: #f5c2c7; cursor: not-allowed; opacity: 0.7; }
        
        .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; display: none; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .badge-istem { background-color: #6f42c1; color: white; }
        .badge-teacher { background-color: #0dcaf0; color: black; }
        .badge-parent { background-color: #ffc107; color: black; }
        
        .receipt-card { border-top: 5px solid #198754; }
        
        @media (max-width: 576px) { .header-content { flex-direction: column; } }
    </style>
</head>
<body>

    <div class="banner-container">
        <div class="container d-flex justify-content-center align-items-center gap-3 flex-wrap header-content">
            <div class="text-center">
                <img src="https://img2.pic.in.th/pic/PSUWIT_Circle.png" class="logo-circle">
                <p class="mt-2 text-white-50 m-0">ระบบลงทะเบียนกิจกรรม workshop</p>
                <p class="mt-2 text-white-50 m-0">มอ.ว วิชาการ ครั้งที่ 3 ปีการศึกษา</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="loginSection" class="main-card">
            <h4 class="text-center mb-4 fw-bold" style="color: var(--primary-color);">
                <i class="bi bi-person-circle"></i> ข้อมูลนักเรียน
            </h4>
            <form onsubmit="checkAndGo(event)">
                <div class="mb
